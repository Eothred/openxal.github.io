<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_31) on Thu Feb 05 15:44:32 EST 2015 -->
<title>CsContinuationEstimator</title>
<meta name="date" content="2015-02-05">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="CsContinuationEstimator";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html" title="class in xal.extension.twissobserver"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../xal/extension/twissobserver/CsFixedPtEstimator.html" title="class in xal.extension.twissobserver"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?xal/extension/twissobserver/CsContinuationEstimator.html" target="_top">Frames</a></li>
<li><a href="CsContinuationEstimator.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">xal.extension.twissobserver</div>
<h2 title="Class CsContinuationEstimator" class="title">Class CsContinuationEstimator</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li><a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html" title="class in xal.extension.twissobserver">xal.extension.twissobserver.CourantSnyderEstimator</a></li>
<li>
<ul class="inheritance">
<li>xal.extension.twissobserver.CsContinuationEstimator</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">CsContinuationEstimator</span>
extends <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html" title="class in xal.extension.twissobserver">CourantSnyderEstimator</a></pre>
<div class="block"><p>
 Computes the covariance matrix at a given location which is most likely to produce the provided
 data.  That is, the covariance matrix is constructed at the given device location
 from the data provided.  The method used is a continuation method where a curve of 
 covariance matrices is constructed from a known solution value, the zero-current case, to the
 solution value for the given beam charge.
 </p>
 <p>  
 The iterates are computed using a continuation method as
 described in the paper "Implementation of a Beam Envelope State Observer."  Specifically,
 let <i>n</i> be the number of independent phase planes we are considering (here it is
 3).  Then assume a <em>smooth</em> solution curve 
 <b>s</b>(&middot;) : <b>R</b> &rarr; <b>R</b><sup>3<i>n</i></sup> 
 mapping bunch charge <i>q</i> to the solution <b>&sigma;</b> &in; <b>R</b><sup>3<i>n</i></sup> of 
 independent beam moments at that charge.  
 Moreover, we have <b>&sigma;</b>* = <b>s</b>(<i>q</i>*) where <i>q</i>* is the bunch charge
 at the given profile data <b>X</b>.  
 </p>
 <p>
 In the analysis we have constructed a known function 
 <b>G</b> : <b>R</b><sup>3<i>n</i></sup> &times; <b>R</b> &rarr; <b>R</b><sup>3<i>n</i></sup> such that
 <br/>
 <br/>
 &nbsp; &nbsp; <b>G</b>[<b>s</b>(<i>q</i>),<i>q</i>] = <b>0</b>,
 <br/>
 <br/>
 that is, <b>G</b> = 0 whenever <b>s</b> is the least-squares solution to the problem of reconstructing
 the Courant-Snyder parameters for the given bunch charge <i>q</i> (and given data <b>X</b>).
 The solution curve <b>s</b>(&middot;) is constructed using continuity starting from a known value 
 <b>s</b>(0) = <b>&sigma;</b><sub>0</sub>, the zero-current solution.  Given that the value of <b>s</b>
 is known at <i>q</i>, the value of <b>s</b> at a small distance &Delta;<i>q</i> from <i>q</i> is 
 <br/>
 <br/>
 &nbsp; &nbsp; <b>s</b>(<i>q</i>+&Delta;<i>q</i>) = <b>s</b>(<i>q</i>) 
                                                  + [d<b>s</b>(<i>q</i>)/d<i>q</i>]&Delta;<i>q</i>
                                                  + <i>O</i>(&Delta;<i>q</i>&sup2;) .
 <br/>
 <br/>
 Essentially this method recursively computes d<b>s</b>(<i>q</i>)/d<i>q</i> and updates <b>s</b>(<i>q</i>)
 according to the above.
 </p>
 <p>
 The value d<b>s</b>(<i>q</i>)/d<i>q</i> is computed by consideration of the known function 
 <b>G</b>.  We take the full derivative of the equation <b>G</b> = <b>0</b> w.r.t. to <i>q</i>
 which yields
 <br/>
 <br/>
 &nbsp; &nbsp; d<b>s</b>(<i>q</i>)/d<i>q</i> = [&part;<b>G</b>(<b>s</b>,<i>q</i>)/&part;<b>s</b>]<sup>-1</sup>
                                               [&part;<b>G</b>(<b>s</b>,<i>q</i>)/&part;<i>q</i>] .
 <br/>
 <br/>
 Once this value is computed the next value on the curve <b>s</b>(&middot) 
 is the vector <b>s</b>(<i>q</i>+&Delta;<i>q</i>) = <b>s</b>(<i>q</i>) + [d<b>s</b>(<i>q</i>)/d<i>q</i>]&Delta;<i>q</i>.  
 The partial derivatives are computed numerically
 about the given values of <b>s</b> = <var>matSig0</var> and <i>q</i> = <var>dblBnchChg</var> using
 step lengths provided by the methods <code><code>#setChargeDerivativeStepPercent(double)</code></code>
 and <code><code>#setMomentDerivativeStepPercent(double)</code></code>. 
 </p>

 <h4>NOTES:</h4>
 &middot; Bunch charge <i>Q</i> is given by beam current <i>I</i> divided by
          machine frequency <i>f</i>.  Specifically, <i>Q</i> = <i>I</i>/<i>f</i>.
 <br/>
 &middot; A <code><a href="../../../xal/extension/twissobserver/TransferMatrixGenerator.html" title="class in xal.extension.twissobserver"><code>TransferMatrixGenerator</code></a></code> object must be supplied
 for the construction of one of these objects.  This is done because of
 the variety of options that exist when creating the transfer matrix
 generator.  It is safer to require pre-construction of the matrix
 generator rather than offer all the options for such generation here.
 <br/>
 &middot; Bunch charge <i>Q</i> is given by beam current <i>I</i> divided by
          machine frequency <i>f</i>.  Specifically, <i>Q</i> = <i>I</i>/<i>f</i>.
 <br/>
 &middot; The derivatives are computed by take the percentage of the current
 value of the independent variable.  This will not work well when that value
 is near zero and the independent variable has a large domain.  Taking the 
 percentage of the domain size would be a better policy if that is possible.
 </p></div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>Apr 15, 2013</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#BOL_FIX_PT_SRCH">BOL_FIX_PT_SRCH</a></span></code>
<div class="block">Whether or not to use an embedded fixed point search</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#CNT_CHRG_STEPS">CNT_CHRG_STEPS</a></span></code>
<div class="block">Default number of space charge steps used in continuation</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static double</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#DBL_DEL_CURR_FRAC">DBL_DEL_CURR_FRAC</a></span></code>
<div class="block">Default fractional perturbation of the beam current used to compute the partial of the recursion function</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static double</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#DBL_DEL_MMT_FRAC">DBL_DEL_MMT_FRAC</a></span></code>
<div class="block">Default fractional perturbation of moment vector used to compute the partial of the recursion function</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="fields.inherited.from.class.xal.extension.twissobserver.CourantSnyderEstimator">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;xal.extension.twissobserver.<a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html" title="class in xal.extension.twissobserver">CourantSnyderEstimator</a></h3>
<code><a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#bolDebug">bolDebug</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#dblConvErr">dblConvErr</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#dblResErr">dblResErr</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#fmtMatrix">fmtMatrix</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#genTransMat">genTransMat</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#matCurrF">matCurrF</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#matCurrSigma">matCurrSigma</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#CsContinuationEstimator-boolean-int-double-double-xal.extension.twissobserver.TransferMatrixGenerator-">CsContinuationEstimator</a></span>(boolean&nbsp;bol2ndSrch,
                       int&nbsp;cntChgSteps,
                       double&nbsp;dblDelMmtFrac,
                       double&nbsp;dblDelCurFrac,
                       <a href="../../../xal/extension/twissobserver/TransferMatrixGenerator.html" title="class in xal.extension.twissobserver">TransferMatrixGenerator</a>&nbsp;genTransMat)</code>
<div class="block">Creates a new instance of <code>ContinuationSolution</code>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#CsContinuationEstimator-xal.extension.twissobserver.TransferMatrixGenerator-">CsContinuationEstimator</a></span>(<a href="../../../xal/extension/twissobserver/TransferMatrixGenerator.html" title="class in xal.extension.twissobserver">TransferMatrixGenerator</a>&nbsp;genTransMat)</code>
<div class="block">Creates a new instance of <code>ContinuationSolution</code>.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code><a href="../../../xal/tools/beam/CovarianceMatrix.html" title="class in xal.tools.beam">CovarianceMatrix</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#computeReconstruction-java.lang.String-double-double-java.util.ArrayList-">computeReconstruction</a></span>(java.lang.String&nbsp;strRecDevId,
                     double&nbsp;dblBnchFreq,
                     double&nbsp;dblBmCurr,
                     java.util.ArrayList&lt;<a href="../../../xal/extension/twissobserver/Measurement.html" title="class in xal.extension.twissobserver">Measurement</a>&gt;&nbsp;arrData)</code>
<div class="block">
 Computes the covariance matrix at the given location which is most likely to produce the given
 data.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#setBeamChargeSteps-int-">setBeamChargeSteps</a></span>(int&nbsp;cntChgSteps)</code>
<div class="block">
 Sets the number of steps <i>N<sub>q</sub></i> used to move from the zero current 
 solution <b>&sigma;</b><sub>0</sub> to the finite current solution <b>&sigma;</b>* 
 using the continuation method.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#setChargeDerivPerturb-double-">setChargeDerivPerturb</a></span>(double&nbsp;dblDelChgPct)</code>
<div class="block">
 Sets the perturbation factor used to (numerically) compute the partial derivatives with
 respect to the beam charge.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#setMomentDerivPerturb-double-">setMomentDerivPerturb</a></span>(double&nbsp;dblDelMmtPct)</code>
<div class="block">
 Sets the perturbation used to compute (numerically) the partial derivatives with
 respect to the initial beam moments.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#setSecondarySearchIterations-int-">setSecondarySearchIterations</a></span>(int&nbsp;cntMaxIters)</code>
<div class="block">Directly sets the maximum number of iterations allowed for the secondary search algorithm.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../xal/extension/twissobserver/CsContinuationEstimator.html#setUseSecondarySearch-boolean-">setUseSecondarySearch</a></span>(boolean&nbsp;bolScndSrch)</code>
<div class="block">Sets whether or not to use a second, internal search method within the continuation
 solution method (i.e., method 2).</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.xal.extension.twissobserver.CourantSnyderEstimator">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;xal.extension.twissobserver.<a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html" title="class in xal.extension.twissobserver">CourantSnyderEstimator</a></h3>
<code><a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#computeConvergenceError-xal.tools.beam.CovarianceMatrix-xal.tools.beam.CovarianceMatrix-">computeConvergenceError</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#computeObservationMatrix-xal.extension.twissobserver.PHASEPLANE-java.lang.String-java.util.ArrayList-">computeObservationMatrix</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#computeObservationMatrix-java.lang.String-java.util.ArrayList-">computeObservationMatrix</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#computeReconFunction-xal.tools.beam.CovarianceMatrix-double-double-java.lang.String-java.util.ArrayList-">computeReconFunction</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#computeReconSubFunction-xal.extension.twissobserver.PHASEPLANE-java.lang.String-java.util.ArrayList-">computeReconSubFunction</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#computeResidualError-xal.tools.beam.CovarianceMatrix-java.lang.String-java.util.ArrayList-">computeResidualError</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#computeZeroCurrReconFunction-java.lang.String-java.util.ArrayList-">computeZeroCurrReconFunction</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#getReconConvergenceError--">getReconConvergenceError</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#getReconResidualError--">getReconResidualError</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#getReconstruction--">getReconstruction</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#isDebuggingOn--">isDebuggingOn</a>, <a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#setDebug-boolean-">setDebug</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="BOL_FIX_PT_SRCH">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>BOL_FIX_PT_SRCH</h4>
<pre>public static final&nbsp;boolean BOL_FIX_PT_SRCH</pre>
<div class="block">Whether or not to use an embedded fixed point search</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../constant-values.html#xal.extension.twissobserver.CsContinuationEstimator.BOL_FIX_PT_SRCH">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="CNT_CHRG_STEPS">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>CNT_CHRG_STEPS</h4>
<pre>public static final&nbsp;int CNT_CHRG_STEPS</pre>
<div class="block">Default number of space charge steps used in continuation</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../constant-values.html#xal.extension.twissobserver.CsContinuationEstimator.CNT_CHRG_STEPS">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="DBL_DEL_MMT_FRAC">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DBL_DEL_MMT_FRAC</h4>
<pre>public static final&nbsp;double DBL_DEL_MMT_FRAC</pre>
<div class="block">Default fractional perturbation of moment vector used to compute the partial of the recursion function</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../constant-values.html#xal.extension.twissobserver.CsContinuationEstimator.DBL_DEL_MMT_FRAC">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="DBL_DEL_CURR_FRAC">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>DBL_DEL_CURR_FRAC</h4>
<pre>public static final&nbsp;double DBL_DEL_CURR_FRAC</pre>
<div class="block">Default fractional perturbation of the beam current used to compute the partial of the recursion function</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../constant-values.html#xal.extension.twissobserver.CsContinuationEstimator.DBL_DEL_CURR_FRAC">Constant Field Values</a></dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="CsContinuationEstimator-xal.extension.twissobserver.TransferMatrixGenerator-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>CsContinuationEstimator</h4>
<pre>public&nbsp;CsContinuationEstimator(<a href="../../../xal/extension/twissobserver/TransferMatrixGenerator.html" title="class in xal.extension.twissobserver">TransferMatrixGenerator</a>&nbsp;genTransMat)</pre>
<div class="block">Creates a new instance of <code>ContinuationSolution</code>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>genTransMat</code> - a pre-configured transfer matrix engine used internally.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>Apr 15, 2013</dd>
</dl>
</li>
</ul>
<a name="CsContinuationEstimator-boolean-int-double-double-xal.extension.twissobserver.TransferMatrixGenerator-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>CsContinuationEstimator</h4>
<pre>public&nbsp;CsContinuationEstimator(boolean&nbsp;bol2ndSrch,
                               int&nbsp;cntChgSteps,
                               double&nbsp;dblDelMmtFrac,
                               double&nbsp;dblDelCurFrac,
                               <a href="../../../xal/extension/twissobserver/TransferMatrixGenerator.html" title="class in xal.extension.twissobserver">TransferMatrixGenerator</a>&nbsp;genTransMat)</pre>
<div class="block">Creates a new instance of <code>ContinuationSolution</code>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>bol2ndSrch</code> - use the fixed point secondary search between beam charge steps</dd>
<dd><code>cntCurSteps</code> - number of steps used to move (continuously) from zero charge to full charge</dd>
<dd><code>dblDelMmtFrac</code> - the fractional perturbation in moment vector used to compute the partial of the recursion function</dd>
<dd><code>dblDelCurFrac</code> - the fractional perturbation of the beam current used to compute the recursion function partial</dd>
<dd><code>genTransMat</code> - a pre-configured transfer matrix engine used internally.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>Apr 15, 2013</dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="setUseSecondarySearch-boolean-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setUseSecondarySearch</h4>
<pre>public&nbsp;void&nbsp;setUseSecondarySearch(boolean&nbsp;bolScndSrch)</pre>
<div class="block">Sets whether or not to use a second, internal search method within the continuation
 solution method (i.e., method 2).  This internal search is simply and application of
 method 1 to move the current beam charge value back onto the (continuous) solution curve.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>bolScndSrch</code> - use the secondary search if <code>true</code>, no internal search if <code>false</code></dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>Apr 5, 2013</dd>
</dl>
</li>
</ul>
<a name="setSecondarySearchIterations-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setSecondarySearchIterations</h4>
<pre>public&nbsp;void&nbsp;setSecondarySearchIterations(int&nbsp;cntMaxIters)</pre>
<div class="block">Directly sets the maximum number of iterations allowed for the secondary search algorithm.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>cntMaxIters</code> - maximum number of allowed secondary search iterations</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>Apr 18, 2013</dd>
</dl>
</li>
</ul>
<a name="setBeamChargeSteps-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setBeamChargeSteps</h4>
<pre>public&nbsp;void&nbsp;setBeamChargeSteps(int&nbsp;cntChgSteps)</pre>
<div class="block"><p>
 Sets the number of steps <i>N<sub>q</sub></i> used to move from the zero current 
 solution <b>&sigma;</b><sub>0</sub> to the finite current solution <b>&sigma;</b>* 
 using the continuation method.  Letting <i>q</i>* denote the beam charge at solution
 <b>&sigma;*</b>,
 then the continuation method computes the solutions <b>&sigma;</b><sub><i>n</i></sub>
 to the sub-problems with beam charge <i>n&Delta;q</i> 
 for each <i>n</i> = 0, 1, ..., <i>N<sub>q</sub></i> 
 where &Delta;<i>q</i> &equiv; <i>q*</i>/<i>N<sub>q</sub></i> .
 </p></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>cntCurSteps</code> - number of steps used to approach the true beam charge solution from the 
                      zero current solution using the continuation method</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>Apr 2, 2013</dd>
</dl>
</li>
</ul>
<a name="setChargeDerivPerturb-double-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setChargeDerivPerturb</h4>
<pre>public&nbsp;void&nbsp;setChargeDerivPerturb(double&nbsp;dblDelChgPct)</pre>
<div class="block"><p>
 Sets the perturbation factor used to (numerically) compute the partial derivatives with
 respect to the beam charge.  The value of beam current is increased this fractional amount
 of the current value when computing 
 numerical derivatives.  Specifically, if perturbation factor is denoted &epsilon;, then  
 the beam charge <i>q</i> is perturbed by an amount &epsilon;<i>q</i>, that is, the perturbed
 charged <i>q</i>' is given by
 <br/>
 <br/>
 &nbsp; &nbsp;  <i>q</i>' = <i>q</i> + &epsilon;<i>q</i>
 <br/>
 <br/>
 </p></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>dblDelCurPct</code> - a value in (0,1) indicating the fraction of the current charge used as perturbation</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>Nov 28, 2012</dd>
</dl>
</li>
</ul>
<a name="setMomentDerivPerturb-double-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setMomentDerivPerturb</h4>
<pre>public&nbsp;void&nbsp;setMomentDerivPerturb(double&nbsp;dblDelMmtPct)</pre>
<div class="block"><p>
 Sets the perturbation used to compute (numerically) the partial derivatives with
 respect to the initial beam moments.  The value of each moment is increased 
 this fractional amount of its current value when computing 
 numerical derivatives.  Specifically, if this value is denoted &epsilon;
 and &sigma;<sub><i>i</i></sub> is the <i>i<sup>th</sup></i> element of moment
 vector <b>&sigma;</b>, then the perturbed moment vector <b>&sigma;</b>' is given
 by 
 <br/>
 <br/>
 &nbsp; &nbsp;  <b>&sigma;</b>' = <b>&sigma;</b> + &epsilon;&sigma;<sub><i>i</i></sub><b>e</b><sub><i>i</i></sub> ,
 <br/>
 <br/>
 where <b>e</b><sub><i>i</i></sub> is the standard basis vector for moment &sigma;<i>i</i>. 
 </p></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>dblDelMmtPct</code> - a value in (0,1) is the fraction of the current moment value used as the derivative step</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>Nov 28, 2012</dd>
</dl>
</li>
</ul>
<a name="computeReconstruction-java.lang.String-double-double-java.util.ArrayList-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>computeReconstruction</h4>
<pre>public&nbsp;<a href="../../../xal/tools/beam/CovarianceMatrix.html" title="class in xal.tools.beam">CovarianceMatrix</a>&nbsp;computeReconstruction(java.lang.String&nbsp;strRecDevId,
                                              double&nbsp;dblBnchFreq,
                                              double&nbsp;dblBmCurr,
                                              java.util.ArrayList&lt;<a href="../../../xal/extension/twissobserver/Measurement.html" title="class in xal.extension.twissobserver">Measurement</a>&gt;&nbsp;arrData)
                                       throws <a href="../../../xal/model/ModelException.html" title="class in xal.model">ModelException</a></pre>
<div class="block"><p>
 Computes the covariance matrix at the given location which is most likely to produce the given
 data.  That is, the covariance matrix is constructed at the given device location
 from the data provided.  The method used is a continuation method where a curve of 
 covariance matrices is constructed from a known solution value, the zero-current case, to the
 solution value for the given beam charge.
 </p>
 <p>  
 The iterates are computed using a continuation method as
 described in the paper "Implementation of a Beam Envelope State Observer."  Specifically,
 let <i>n</i> be the number of independent phase planes we are considering (here it is
 3).  Then assume a <em>smooth</em> solution curve 
 <b>s</b>(&middot;) : <b>R</b> &rarr; <b>R</b><sup>3<i>n</i></sup> 
 mapping bunch charge <i>q</i> to the solution <b>&sigma;</b> &in; <b>R</b><sup>3<i>n</i></sup> of 
 independent beam moments at that charge.  
 Moreover, we have <b>&sigma;</b>* = <b>s</b>(<i>q</i>*) where <i>q</i>* is the bunch charge
 at the given profile data <b>X</b>.  
 </p>
 <p>
 In the analysis we have constructed a known function 
 <b>G</b> : <b>R</b><sup>3<i>n</i></sup> &times; <b>R</b> &rarr; <b>R</b><sup>3<i>n</i></sup> such that
 <br/>
 <br/>
 &nbsp; &nbsp; <b>G</b>[<b>s</b>(<i>q</i>),<i>q</i>] = <b>0</b>,
 <br/>
 <br/>
 that is, <b>G</b> = 0 whenever <b>s</b> is the least-squares solution to the problem of reconstructing
 the Courant-Snyder parameters for the given bunch charge <i>q</i> (and given data <b>X</b>).
 The solution curve <b>s</b>(&middot;) is constructed using continuity starting from a known value 
 <b>s</b>(0) = <b>&sigma;</b><sub>0</sub>, the zero-current solution.  Given that the value of <b>s</b>
 is known at <i>q</i>, the value of <b>s</b> at a small distance &Delta;<i>q</i> from <i>q</i> is 
 <br/>
 <br/>
 &nbsp; &nbsp; <b>s</b>(<i>q</i>+&Delta;<i>q</i>) = <b>s</b>(<i>q</i>) 
                                                  + [d<b>s</b>(<i>q</i>)/d<i>q</i>]&Delta;<i>q</i>
                                                  + <i>O</i>(&Delta;<i>q</i>&sup2;) .
 <br/>
 <br/>
 Essentially this method recursively computes d<b>s</b>(<i>q</i>)/d<i>q</i> and updates <b>s</b>(<i>q</i>)
 according to the above.
 </p>
 <p>
 The value d<b>s</b>(<i>q</i>)/d<i>q</i> is computed by consideration of the known function 
 <b>G</b>.  We take the full derivative of the equation <b>G</b> = <b>0</b> w.r.t. to <i>q</i>
 which yields
 <br/>
 <br/>
 &nbsp; &nbsp; d<b>s</b>(<i>q</i>)/d<i>q</i> = [&part;<b>G</b>(<b>s</b>,<i>q</i>)/&part;<b>s</b>]<sup>-1</sup>
                                               [&part;<b>G</b>(<b>s</b>,<i>q</i>)/&part;<i>q</i>] .
 <br/>
 <br/>
 Once this value is computed the next value on the curve <b>s</b>(&middot) 
 is the vector <b>s</b>(<i>q</i>+&Delta;<i>q</i>) = <b>s</b>(<i>q</i>) + [d<b>s</b>(<i>q</i>)/d<i>q</i>]&Delta;<i>q</i>.  
 The partial derivatives are computed numerically
 about the given values of <b>s</b> = <var>matSig0</var> and <i>q</i> = <var>dblBnchChg</var> using
 step lengths provided by the methods <code><code>#setChargeDerivativeStepPercent(double)</code></code>
 and <code><code>#setMomentDerivativeStepPercent(double)</code></code>. 
 </p></div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html#computeReconstruction-java.lang.String-double-double-java.util.ArrayList-">computeReconstruction</a></code>&nbsp;in class&nbsp;<code><a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html" title="class in xal.extension.twissobserver">CourantSnyderEstimator</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>strRecDevId</code> - ID of the device where the reconstruction is to be performed</dd>
<dd><code>dblBnchFreq</code> - bunch arrival frequency for the given data (in Hz)</dd>
<dd><code>dblBmCurr</code> - beam current (in Amperes)</dd>
<dd><code>arrData</code> - the profile measurement data used for the reconstruction</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>block diagonal covariance matrix (uncoupled in the phase planes) containing the second-order
          moments of the beam at the reconstruction location</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../xal/model/ModelException.html" title="class in xal.model">ModelException</a></code> - error occurred during the transfer matrix computations</dd>
<dd><code><a href="../../../xal/extension/twissobserver/ConvergenceException.html" title="class in xal.extension.twissobserver">ConvergenceException</a></code> - this is for the internal call to <code>#computeReconstruction(String, double, CovarianceMatrix, ArrayList)</code></dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>Apr 2, 2013</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../xal/extension/twissobserver/CourantSnyderEstimator.html" title="class in xal.extension.twissobserver"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../xal/extension/twissobserver/CsFixedPtEstimator.html" title="class in xal.extension.twissobserver"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?xal/extension/twissobserver/CsContinuationEstimator.html" target="_top">Frames</a></li>
<li><a href="CsContinuationEstimator.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
